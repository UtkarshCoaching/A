const questions = [

    {
        question: "আলফ্রেড ওয়েগনার মহাদেশীয় সঞ্চরণ তত্ত্ব কত সালে প্রকাশ করেন?",
        options: [
            "1912 খ্রিস্টাব্দে",
            "1924 খ্রিস্টাব্দে",
            "1904 খ্রিস্টাব্দে",
            "1920 খ্রিস্টাব্দে"
        ],
        answer: "1912 খ্রিস্টাব্দে"
    },
    {
        question: "প্যানজিয়ার ভাঙন অতীতে কতবার হয়েছে?",
        options: [
            "1 বার",
            "2 বার",
            "3 বার",
            "4 বার"
        ],
        answer: "2 বার"
    },
    {
        question: "পৃথিবীর সমস্ত মহাদেশগুলি একত্রিত হয়ে প্যানজিয়া গঠন করেছিল, যে উপযুগের আগে তা হল-",
        options: [
            "সিলুরিয়ান",
            "ক্রেটেশিয়াস",
            "কার্বনিফেরাস",
            "ট্রায়াসিক"
        ],
        answer: "কার্বনিফেরাস" // প্যানজিয়ার গঠন কার্বনিফেরাস যুগে শুরু হয়েছিল এবং পার্মিয়ান যুগে সম্পূর্ণ হয়।
    },
    {
        question: "ওয়েগনারের মতে, প্যানজিয়ার উত্তর অংশটির নাম-",
        options: [
            "গন্ডোয়ানাল্যান্ড",
            "লরেশিয়া",
            "আঙ্গারা ল্যান্ড", // লরেশিয়ার অংশ
            "কোনোটিই নয়"
        ],
        answer: "লরেশিয়া"
    },
    {
        question: "ওয়েগনারের মতে, প্যানজিয়ার দক্ষিণ অংশের নাম-",
        options: [
            "লরেশিয়া",
            "হিমান্তল্যান্ড",
            "গন্ডোয়ানাল্যান্ড",
            "হিমালয়"
        ],
        answer: "গন্ডোয়ানাল্যান্ড"
    },
    {
        question: "প্যানজিয়া মহাদেশের কেন্দ্রে যে ভূখণ্ড ছিল, তা হল-",
        options: [
            "এশিয়া",
            "আফ্রিকা",
            "ইউরোপ",
            "অস্ট্রেলিয়া"
        ],
        answer: "আফ্রিকা"
    },
    {
        question: "আদি মহাদেশ প্যানজিয়ার ভাঙন শুরু যে যুগে, তা হল-",
        options: [
            "অর্ডোভিশিয়ান",
            "সিনোজোইক",
            "মেসোজোইক",
            "কার্বনিফেরাস"
        ],
        answer: "মেসোজোইক" // মেসোজোইক যুগের ট্রায়াসিক পিরিয়ডে ভাঙন শুরু হয়।
    },
    {
        question: "উত্তর আমেরিকা ও এশিয়া পশ্চিম দিকে সঞ্চালনের ফলে যে মহাসাগরের সৃষ্টি হয়েছে, তা হলো-",
        options: [
            "প্রশান্ত মহাসাগর",
            "ভারত মহাসাগর",
            "আটলান্টিক মহাসাগর",
            "সুমেরু মহাসাগর"
        ],
        answer: "আটলান্টিক মহাসাগর" // উত্তর আমেরিকা পশ্চিম দিকে সরে আটলান্টিক মহাসাগরের সৃষ্টিতে সহায়তা করে।
    },
    {
        question: "প্যানজিয়ার পূর্বে সঞ্চালনের ফলে যে মহাসাগরের সৃষ্টি হয়েছে, তা হলো-", // প্রশ্নটি অস্পষ্ট, তবে প্রচলিত ধারণা অনুযায়ী উত্তর দেওয়া হলো।
        options: [
            "আটলান্টিক মহাসাগর",
            "ভারত মহাসাগর",
            "সুমেরু মহাসাগর",
            "প্রশান্ত মহাসাগর"
        ],
        answer: "প্রশান্ত মহাসাগর" // প্যান্থালসা থেকে প্রশান্ত মহাসাগরের বিবর্তন
    },
    {
        question: "আলফ্রেড ওয়েগনার মহাদেশীয় সঞ্চরণ তত্ত্ব উপস্থাপন করেন-",
        options: [
            "1912 খ্রিস্টাব্দে",
            "1910 খ্রিস্টাব্দে",
            "1924 খ্রিস্টাব্দে",
            "1908 খ্রিস্টাব্দে"
        ],
        answer: "1912 খ্রিস্টাব্দে" // প্রশ্নটি ১নং প্রশ্নের পুনরাবৃত্তি।
    },
    {
        question: "উত্তর ও দক্ষিণ আমেরিকা পশ্চিম দিকে সঞ্চরণের ফলে যে মহাসাগরের সৃষ্টি হয়েছে, তা হল-",
        options: [
            "প্রশান্ত মহাসাগর",
            "আটলান্টিক মহাসাগর",
            "ভারত মহাসাগর",
            "সুমেরু মহাসাগর"
        ],
        answer: "আটলান্টিক মহাসাগর"
    },
    {
        question: "আফ্রিকা ও অস্ট্রেলিয়া যে প্রাচীন ভূখণ্ডের অংশ ছিল-",
        options: [
            "লরেশিয়া",
            "প্যানজিয়া",
            "গন্ডোয়ানাল্যান্ড",
            "ইউরেশিয়া"
        ],
        answer: "গন্ডোয়ানাল্যান্ড"
    },
    {
        question: "মহাদেশীয় সঞ্চালনের কারণগুলি ওয়েগনারের মতে হল-",
        options: [
            "পৃথিবীর আবর্তন",
            "জোয়ারি শক্তি",
            "বৈষম্যমূলক অভিকর্ষজ বল",
            "সবগুলি"
        ],
        answer: "সবগুলি" // ওয়েগনার এই তিনটি শক্তিকেই কারণ হিসেবে উল্লেখ করেছিলেন।
    },
    {
        question: "ওয়েগনারের মতে মহাদেশীয় সঞ্চরণ শুরু হয়েছিল-",
        options: [
            "উত্তর মেরু থেকে",
            "মেরুদেশ থেকে", // মেরুবিমুখী বলের কারণে
            "বিষুবরেখা থেকে",
            "মেরুবর্তী ক্রান্তিরেখা থেকে"
        ],
        answer: "মেরুদেশ থেকে"
    },
    {
        question: "যে শক্তির প্রভাবে উত্তর ও দক্ষিণ আমেরিকা পশ্চিম দিকে সঞ্চারিত হয়েছিল, তার নাম-",
        options: [
            "বৈষম্যমূলক অভিকর্ষজ বল",
            "জোয়ারি শক্তি", // ওয়েগনার জোয়ারি শক্তিকে পশ্চিমমুখী সঞ্চালনের কারণ বলেছিলেন।
            "মেরুভিমুখী শক্তি",
            "কোনোটিই নয়"
        ],
        answer: "জোয়ারি শক্তি"
    },
    {
        question: "বৈষম্যমূলক অভিকর্ষজ বলের প্রভাবে মহাদেশগুলির সঞ্চরণ ঘটেছিল-",
        options: [
            "পূর্বদিকে",
            "উত্তর দিকে",
            "পশ্চিম দিকে",
            "দক্ষিণ দিকে"
        ],
        answer: "দক্ষিণ দিকে" // মেরুবিমুখী বল (যা অভিকর্ষজ বলের বৈষম্যের সাথে সম্পর্কিত) মহাদেশগুলিকে নিরক্ষরেখার দিকে ঠেলেছিল।
    },
    {
        question: "কার্বনিফেরাস যুগে দক্ষিণ মেরুর অবস্থান ছিল যে অক্ষাংশ ও দ্রাঘিমাংশে তা হল-",
        options: [
            "40° উ 50° পূ", // 40°N 50°E
            "40° দ 50° প", // 40°S 50°W
            "50° উ 50° পূ", // 50°N 50°E
            "40° দ 50° পূ"  // 40°S 50°E
        ],
        answer: "40° দ 50° পূ"
    },
    {
        question: "ওয়েগনারের মতে, আফ্রিকার পশ্চিম ভাগের স্ফীত অংশটিকে যে উপসাগরে প্রবেশ করানো যায়, তা হল-",
        options: [
            "ভারত মহাসাগরে",
            "প্রশান্ত মহাসাগরে",
            "আটলান্টিক মহাসাগরে",
            "ভূমধ্যসাগরে"
        ],
        answer: "আটলান্টিক মহাসাগরে" // আফ্রিকা ও দক্ষিণ আমেরিকার মধ্যে 'জিগ-স পাজল' ফিট।
    },
    {
        question: "মহাদেশীয় সঞ্চরণ তত্ত্বের প্রস্তাবক ছিলেন-",
        options: [
            "আলফ্রেড ওয়েগনার",
            "এ.ভি. টোল",
            "আর্থার হোমস্",
            "হ্যারি হেস"
        ],
        answer: "আলফ্রেড ওয়েগনার" // প্রশ্নটি ১ ও ১০ নং প্রশ্নের সাথে সম্পর্কিত, তবে ভিন্নভাবে জিজ্ঞাসা করা হয়েছে।
    },
    {
        question: "মহাদেশীয় সঞ্চরণ তত্ত্ব অনুসারে অতীতে মহাদেশগুলি একত্রিত হয়ে যে নামে পরিচিত ছিল, তা হলো-",
        options: [
            "প্যান্থালসা",
            "গন্ডোয়ানাল্যান্ড",
            "লরেশিয়া",
            "প্যানজিয়া"
        ],
        answer: "প্যানজিয়া"
    },
    {
        question: "সমুদ্র তলদেশের সম্প্রসারণ তত্ত্বের প্রস্তাবক ছিলেন-",
        options: [
            "আর্থার হোমস্",
            "হ্যারি হেস",
            "আলফ্রেড ওয়েগনার",
            "উইলসন"
        ],
        answer: "হ্যারি হেস"
    },
    {
        question: "প্যানজিয়ার পূর্বে যে মহাসাগরগুলি একত্রিত অবস্থায় বসে ছিল, তা হল-", // প্রশ্নটি অস্পষ্ট, তবে 'প্যান্থালসা' প্যানজিয়ার চারপাশের মহাসাগর ছিল।
        options: [
            "লরেশিয়া",
            "প্যান্থালসা",
            "গন্ডোয়ানাল্যান্ড",
            "টেথিস"
        ],
        answer: "প্যান্থালসা"
    },
    {
        question: "আলফ্রেড ওয়েগনার মহাদেশীয় সঞ্চরণ তত্ত্ব উপস্থাপন করেন-", // প্রশ্নটি ১ ও ১০ নং প্রশ্নের পুনরাবৃত্তি।
        options: [
            "1912 খ্রিস্টাব্দে",
            "1910 খ্রিস্টাব্দে",
            "1924 খ্রিস্টাব্দে",
            "1908 খ্রিস্টাব্দে"
        ],
        answer: "1912 খ্রিস্টাব্দে"
    },
    {
        question: "লরেশিয়াতে অন্তর্ভুক্ত দেশগুলির মধ্যে কোনটি?", // প্রশ্নটি পরিষ্কার করার জন্য 'মধ্যে কোনটি' যোগ করা হলো।
        options: [
            "উত্তর আমেরিকা",
            "দক্ষিণ আমেরিকা",
            "এশিয়া",
            "ইউরোপ"
        ],
        answer: "উত্তর আমেরিকা" // লরেশিয়াতে উত্তর আমেরিকা, ইউরোপ এবং এশিয়ার বেশিরভাগ অংশ অন্তর্ভুক্ত ছিল। যদি একটি উত্তর বেছে নিতে হয়, তবে এটি একটি বৈধ বিকল্প।
    },
    {
        question: "গন্ডোয়ানাল্যান্ডের অংশ ছিল নিচের কোনটি?", // প্রশ্নটি পরিষ্কার করার জন্য 'অংশ ছিল নিচের কোনটি' যোগ করা হলো।
        options: [
            "ইউরোপ",
            "দক্ষিণ আমেরিকা",
            "অস্ট্রেলিয়া",
            "এশিয়া"
        ],
        answer: "দক্ষিণ আমেরিকা" // যদিও অস্ট্রেলিয়াও গন্ডোয়ানাল্যান্ডের অংশ ছিল, ছবিতে 'দক্ষিণ আমেরিকা' চিহ্নিত আছে।
    },
    {
        question: "গন্ডোয়ানাল্যান্ড গঠিত হয়েছে-",
        options: [
            "ম্যাগনিয়ো থেকে",
            "পার্মিক থেকে",
            "অর্ডোভিশিয়ান এবং ক্যামব্রিয়ান থেকে",
            "সবগুলি থেকে"
        ],
        answer: "পার্মিক থেকে"
    },
    {
        question: "জিওলজিক্যাল প্রমাণ স্বপক্ষে যেগুলি ওয়েগনারের থিউরি প্রমাণ হন-",
        options: [
            "জলবায়ুর গুপ্ত",
            "জিও-ফিটিং",
            "জীবজন্তুর জীবাশ্ম",
            "সবগুলি সঠিক"
        ],
        answer: "সবগুলি সঠিক"
    },
    {
        question: "মহাদেশীয় সঞ্চারণের স্বপক্ষে একটি ভূগাটীয় প্রমাণ হন-",
        options: [
            "জীবজন্তুর জীবাশ্ম",
            "হিমবাহের ক্ষয়ক্ষেপ",
            "কয়লার ভৌগোলিক অবস্থা",
            "জিগ-স ফিটিং"
        ],
        answer: "জিগ-স ফিটিং"
    },
    {
        question: "জিও ফিটিং এর পর সমুদ্রীয় সম্প্রসারণ তত্ত্বের প্রমাণ হন-", // প্রশ্নটি অস্পষ্ট, তবে 'ভূ-অভ্যন্তরস্থ তাপ' সমুদ্রতল সম্প্রসারণের চালিকা শক্তি।
        options: [
            "ভুমধ্যসাগর",
            "প্রশান্ত মহাসাগর",
            "ভূ-অভ্যন্তরস্থ তাপ",
            "ভূমধ্যসাগরীয়"
        ],
        answer: "ভূ-অভ্যন্তরস্থ তাপ"
    },
    {
        question: "মেরু গমন (polar wandering) দ্বারা প্রমাণ করা হয়-",
        options: [
            "ভূতাত্ত্বিক যুগ",
            "বনস্পদ ও প্রাণিজাত",
            "অক্ষাংশ ও দ্রাঘিমাংশ",
            "হিমবোর্ত" // হিমবাহের বন্টন
        ],
        answer: "হিমবোর্ত"
    },
    {
        question: "অস্ট্রেলিয়া ভূখণ্ডের অপেক্ষাকৃত গতিবেগ এর প্রমাণ কোন খনিজ মধ্যে অনুসন্ধান করে পাওয়া গেছে এই ভূগর্ভস্থ ভূ-স্তর থেকে?", // প্রশ্নটি নির্দিষ্ট এবং সম্ভবত 'ব্যান্ডেড আয়রন ফর্মেশন' (BIFs) বা অন্য কিছু বোঝানো হয়েছে।
        options: [
            "অ্যাকটিক লোহা",
            "ক্রোমাইট",
            "প্লাটিনাম",
            "কুইজ লোহা"
        ],
        answer: "কুইজ লোহা"
    },
    {
        question: "পরিবেসন তত্ত্ব অনুসারে সমুদ্রের তলের সম্প্রসারণ হয়েছে-", // 'পরিবেসন তত্ত্ব' সম্ভবত 'সমুদ্র তলদেশের সম্প্রসারণ তত্ত্ব' বোঝানো হয়েছে।
        options: [
            "হ্যারি হেস",
            "উইলসন",
            "ওয়েগনার",
            "আর্থার হোমস্"
        ],
        answer: "হ্যারি হেস"
    },
    {
        question: "ল্যাণ্ড আফ্রিকায় ও দক্ষিণ আমেরিকায় পূর্ব উপকূলের মধ্যে জিওফিটিং এর প্রমাণ-", // সম্ভবত 'ফসিল' (জীবাশ্ম) বোঝানো হয়েছে।
        options: [
            "লিওক্রোন",
            "মেসোজোম", // সম্ভবত মেসোসোরাস জীবাশ্ম বোঝানো হয়েছে।
            "কার্বনোফিশ",
            "নিওক্রোনিয়াম"
        ],
        answer: "মেসোজোম"
    },
    {
        question: "প্যালিওবটানিস্ট হল একটি-",
        options: [
            "ভূত্বীয় উদ্ভিদ বন্টন",
            "মহাদেশীয় বন্টন",
            "জীবজন্তুর উদ্ভিদ",
            "বনস্পন" // বনস্পতি/উদ্ভিদ
        ],
        answer: "বনস্পন"
    },
    {
        question: "দুটি মহাদেশের উত্তর-পূর্ব বিবর্তিত হতে একে অপরের সঙ্গে মিলে যায়-",
        options: [
            "ইউরোপ ও উত্তর আমেরিকা",
            "আফ্রিকা ও অস্ট্রেলিয়া",
            "ইউরেশিয়া ও দক্ষিণ আমেরিকা",
            "ইউরোপ ও আফ্রিকা"
        ],
        answer: "ইউরোপ ও উত্তর আমেরিকা"
    },
    {
        question: "ওয়েগনারের মতে, যে অপক্ষেপণ নির্ণীয় গতি সঞ্চয় করে তা হল-", // খুব সুনির্দিষ্ট এবং অস্পষ্ট।
        options: [
            "45°",
            "35°",
            "25°",
            "15°"
        ],
        answer: "35°"
    },
    {
        question: "ওয়েগনারের মতে, মহাদেশীয় সঞ্চরণের গতি হল-",
        options: [
            "ভৌগোলিক গতি",
            "ঐতিহাসিক গতি",
            "ভূতাত্ত্বিক গতি",
            "মন্থর ও ধীর গতি"
        ],
        answer: "মন্থর ও ধীর গতি"
    },
    {
        question: "ওয়েগনারের মহীসঞ্চরণ তত্ত্বের সমালোচনা করেন-",
        options: [
            "ফিলিপ হেল",
            "অ্যারিস্টন",
            "ক্রিকমার্স",
            "এরা সবাই"
        ],
        answer: "এরা সবাই"
    },
    {
        question: "প্রাথমিক অঙ্গারীয় প্যানজিয়া কোন গোলার্ধে অবস্থিত ছিল-",
        options: [
            "উত্তর গোলার্ধে",
            "দক্ষিণ গোলার্ধে",
            "পূর্ব গোলার্ধে",
            "পশ্চিম গোলার্ধে"
        ],
        answer: "দক্ষিণ গোলার্ধে"
    },
    {
        question: "ইউরোপ, আফ্রিকা ও আমেরিকা পাশাপাশি থাকার প্রস্তাবনার কথা প্রথম কে বলেছিলেন-",
        options: [
            "আলফ্রেড ওয়েগনার",
            "পেলেইরিনি",
            "ডি.বি.ট্যানার",
            "আব্রাহাম ওরেলিয়াস"
        ],
        answer: "আব্রাহাম ওরেলিয়াস"
    }
];

    

let currentQuestionIndex = 0;
let score = 0;
let correctCount = 0;
let wrongCount = 0;
let skippedCount = 0;
let selectedOption = null;
let answeredQuestions = new Array(questions.length).fill(false);
let questionTimerInterval;
const questionTimeLimit = 30;
let questionTimeLeft;
let userName = ''; // ব্যবহারকারীর নাম সংরক্ষণের জন্য ভেরিয়েবল

// DOM Elements
const nameInputScreen = document.getElementById('nameInputScreen');
const userNameInput = document.getElementById('userNameInput');
const proceedToStartScreenButton = document.getElementById('proceedToStartScreenButton');
const nameInputMessage = document.getElementById('nameInputMessage');

const startScreen = document.getElementById('startScreen');
const startButton = document.getElementById('startButton');

const totalQuestionsInfo = document.getElementById('totalQuestionsInfo');
const fullMarksInfo = document.getElementById('fullMarksInfo');
const timeLimitInfo = document.getElementById('timeLimitInfo');

const quizScreen = document.getElementById('quizScreen');
const resultScreen = document.getElementById('resultScreen');

const scoreDisplayElem = document.getElementById('scoreDisplay');
const questionIndexDisplayElem = document.getElementById('questionIndexDisplay');

const questionTextBox = document.getElementById('questionTextBox');
const optionsContainer = document.getElementById('optionsContainer');
const feedbackMessage = document.getElementById('feedbackMessage');
const nextButton = document.getElementById('nextButton');
const skipButton = document.getElementById('skipButton');
const submitButton = document.getElementById('submitButton');

const questionTimerTextElem = document.getElementById('questionTimer');
const progressRingBar = document.querySelector('.progress-ring-bar');
const circumference = 2 * Math.PI * 35;
progressRingBar.style.strokeDasharray = circumference;
progressRingBar.style.strokeDashoffset = circumference;

const rankListElem = document.getElementById('rankList');

// Set initial info on start screen
totalQuestionsInfo.textContent = questions.length;
fullMarksInfo.textContent = questions.length;
timeLimitInfo.textContent = Math.ceil(questions.length * questionTimeLimit / 60);

// --- Event Listeners ---
proceedToStartScreenButton.addEventListener('click', handleNameInputAndShowStartScreen);
startButton.addEventListener('click', startQuiz);

nextButton.addEventListener('click', handleNextQuestion);
skipButton.addEventListener('click', handleSkipQuestion);
submitButton.addEventListener('click', handleSubmitQuiz);


// --- Name Input and Screen Flow ---
function handleNameInputAndShowStartScreen() {
    const inputName = userNameInput.value.trim();
    if (inputName === '') {
        nameInputMessage.textContent = "আপনার নাম লিখুন কুইজ শুরু করার জন্য।";
        return;
    }
    userName = inputName; // ব্যবহারকারীর নাম সংরক্ষণ করুন
    nameInputMessage.textContent = ''; // মেসেজ মুছে ফেলুন

    nameInputScreen.classList.remove('active');
    startScreen.classList.add('active'); // নাম ইনপুট করার পর startScreen দেখান
}


function startQuiz() { // startScreen থেকে কুইজ শুরু করার ফাংশন
    startScreen.classList.remove('active');
    quizScreen.classList.add('active');
    resetQuizState(); // কুইজ স্টেট রিসেট করুন কুইজ শুরু করার আগে
    loadQuestion();
    scoreDisplayElem.textContent = score;
}

function resetQuizState() {
    currentQuestionIndex = 0;
    score = 0;
    correctCount = 0;
    wrongCount = 0;
    skippedCount = 0;
    selectedOption = null;
    answeredQuestions = new Array(questions.length).fill(false);
    clearInterval(questionTimerInterval); // নিশ্চিত করুন কোনো টাইমার চলছে না
}


function updateQuestionTimerDisplay() {
    questionTimerTextElem.textContent = questionTimeLeft;

    const offset = circumference - (questionTimeLeft / questionTimeLimit) * circumference;
    progressRingBar.style.strokeDashoffset = offset;

    // Change color based on time left
    if (questionTimeLeft <= 10) {
        progressRingBar.style.stroke = '#FF6347';
    } else if (questionTimeLeft <= 20) {
        progressRingBar.style.stroke = '#FFD700';
    } else {
        progressRingBar.style.stroke = '#28a745';
    }
}

function startQuestionTimer() {
    clearInterval(questionTimerInterval);
    questionTimeLeft = questionTimeLimit;
    updateQuestionTimerDisplay();
    questionTimerInterval = setInterval(() => {
        questionTimeLeft--;
        updateQuestionTimerDisplay();
        if (questionTimeLeft <= 0) {
            clearInterval(questionTimerInterval);
            // Only proceed if the question hasn't been answered yet
            if (!answeredQuestions[currentQuestionIndex]) {
                handleTimeUp();
            }
        }
    }, 1000);
}


function loadQuestion() {
    if (currentQuestionIndex >= questions.length) {
        handleSubmitQuiz();
        return;
    }
    clearInterval(questionTimerInterval);
    startQuestionTimer();

    const currentQuestion = questions[currentQuestionIndex];
    questionIndexDisplayElem.textContent = `${currentQuestionIndex + 1} / ${questions.length}`;

    questionTextBox.textContent = currentQuestion.question;
    optionsContainer.innerHTML = '';
    feedbackMessage.textContent = '';
    feedbackMessage.style.color = 'transparent';
    selectedOption = null;

    nextButton.style.display = 'none';
    skipButton.style.display = 'inline-block';
    submitButton.style.display = 'none';

    if (currentQuestionIndex === questions.length - 1) {
        submitButton.style.display = 'inline-block';
        nextButton.style.display = 'none';
        skipButton.style.display = 'none';
    }

    currentQuestion.options.forEach(option => {
        const button = document.createElement('button');
        button.classList.add('option');
        button.textContent = option;
        button.addEventListener('click', () => selectOption(button, option));
        optionsContainer.appendChild(button);
    });

    enableOptions();
}


function selectOption(selectedButton, selectedAnswer) {
    if (answeredQuestions[currentQuestionIndex]) return; // Already answered, do nothing

    clearInterval(questionTimerInterval); // Stop the timer as soon as an option is selected

    disableOptions(); // Disable options to prevent multiple clicks

    const currentQuestion = questions[currentQuestionIndex];
    const correctAnswer = currentQuestion.answer;

    selectedButton.classList.add('selected');

    if (selectedAnswer === correctAnswer) {
        selectedButton.classList.add('correct');
        score += 1;
        correctCount++;
        feedbackMessage.textContent = 'সঠিক উত্তর!';
        feedbackMessage.style.color = '#28a745';
    } else {
        selectedButton.classList.add('wrong');
        score -= 0.33;
        wrongCount++;
        feedbackMessage.textContent = `ভুল উত্তর। সঠিক উত্তর: ${correctAnswer}`;
        feedbackMessage.style.color = '#dc3545';

        // Highlight the correct answer if the selected one was wrong
        Array.from(optionsContainer.children).forEach(optionBtn => {
            if (optionBtn.textContent === correctAnswer) {
                optionBtn.classList.add('correct');
            }
        });
    }

    scoreDisplayElem.textContent = score.toFixed(2);
    answeredQuestions[currentQuestionIndex] = true; // Mark as answered

    // Show appropriate buttons
    nextButton.style.display = 'inline-block';
    skipButton.style.display = 'none';
    submitButton.style.display = (currentQuestionIndex === questions.length - 1) ? 'inline-block' : 'none';
}


function handleTimeUp() {
    // This check is crucial for preventing double-skips or skips after an answer
    if (answeredQuestions[currentQuestionIndex]) return;

    skippedCount++;
    answeredQuestions[currentQuestionIndex] = true; // Mark as answered/skipped

    showAnswer(); // Show the correct answer
    disableOptions(); // Disable options

    // Automatically move to the next question after a short delay
    setTimeout(() => {
        currentQuestionIndex++;
        loadQuestion();
    }, 2000); // 2 seconds delay
}

function showAnswer() {
    const currentQuestion = questions[currentQuestionIndex];
    const correctAnswer = currentQuestion.answer;

    Array.from(optionsContainer.children).forEach(optionBtn => {
        optionBtn.style.pointerEvents = 'none'; // Ensure no further clicks
        if (optionBtn.textContent === correctAnswer) {
            optionBtn.classList.add('correct'); // Highlight correct answer
        }
    });
    feedbackMessage.textContent = `সঠিক উত্তর: ${correctAnswer}`;
    feedbackMessage.style.color = '#ffc107'; // Yellow/Orange color for skipped answer

    // Ensure buttons are correctly displayed after showing answer
    nextButton.style.display = 'inline-block';
    skipButton.style.display = 'none';
    submitButton.style.display = (currentQuestionIndex === questions.length - 1) ? 'inline-block' : 'none';
}


function disableOptions() {
    Array.from(optionsContainer.children).forEach(opt => {
        opt.style.pointerEvents = 'none';
    });
}

function enableOptions() {
    Array.from(optionsContainer.children).forEach(opt => {
        opt.style.pointerEvents = 'auto';
        opt.classList.remove('selected', 'correct', 'wrong');
    });
}


function handleNextQuestion() {
    // If user clicks Next without selecting an option, treat as skipped
    if (!answeredQuestions[currentQuestionIndex]) {
        clearInterval(questionTimerInterval); // Stop timer
        skippedCount++;
        answeredQuestions[currentQuestionIndex] = true;
        showAnswer(); // Show answer for skipped question
        disableOptions(); // Disable options
        // Wait briefly before moving to next question for skipped questions
        setTimeout(() => {
            currentQuestionIndex++;
            loadQuestion();
        }, 1000); // Shorter delay for manual skip
    } else {
        // If already answered, just move to next
        currentQuestionIndex++;
        loadQuestion();
    }
}

function handleSkipQuestion() {
    // This is essentially the same as handleTimeUp, but triggered by button click
    if (!answeredQuestions[currentQuestionIndex]) {
        clearInterval(questionTimerInterval);
        skippedCount++;
        answeredQuestions[currentQuestionIndex] = true;

        showAnswer();
        disableOptions();

        setTimeout(() => {
            currentQuestionIndex++;
            loadQuestion();
        }, 1000); // Shorter delay for manual skip
    }
}


function handleSubmitQuiz() {
    clearInterval(questionTimerInterval); // Stop any running timer
    quizScreen.classList.remove('active');
    resultScreen.classList.add('active');

    document.getElementById('finalTotalQuestions').textContent = questions.length;
    document.getElementById('correctAnswers').textContent = correctCount;
    document.getElementById('wrongAnswers').textContent = wrongCount;
    document.getElementById('skippedQuestions').textContent = skippedCount;
    document.getElementById('finalScore').textContent = score.toFixed(2);
    document.getElementById('finalFullMarks').textContent = questions.length;

    // Firebase-এ ফলাফল সেভ করুন এবং র‍্যাঙ্কিং লোড করুন
    saveQuizResult();
    displayRankings();
}

// Firebase-এ ফলাফল সেভ করুন
function saveQuizResult() {
    // নিশ্চিত করুন ব্যবহারকারীর নাম আছে
    if (!userName) {
        console.error("ব্যবহারকারীর নাম পাওয়া যায়নি। ফলাফল সেভ করা যাবে না।");
        alert("আপনার নাম ছাড়া ফলাফল সেভ করা যাবে না।");
        return;
    }

    // Firebase-এর 'quizResults' পাথে এবং QUIZ_ID এর অধীনে ডেটা পুশ করুন
    // খেয়াল রাখবেন QUIZ_ID কে অবশ্যই index.html এ সংজ্ঞায়িত করতে হবে।
    database.ref('quizResults/' + QUIZ_ID).push({
        name: userName, // কুইজের শুরুতে নেওয়া নাম
        score: score.toFixed(2), // স্কোর দশমিক সংখ্যা হিসেবে সেভ করুন
        correct: correctCount,
        wrong: wrongCount,
        skipped: skippedCount,
        totalQuestions: questions.length,
        timestamp: new Date().toISOString() // কখন কুইজ দেওয়া হয়েছে
    })
    .then(() => {
        console.log("ফলাফল সফলভাবে Firebase-এ সেভ হয়েছে!");
    })
    .catch((error) => {
        console.error("ফলাফল সেভ করতে সমস্যা হয়েছে:", error);
        alert("ফলাফল সেভ করতে সমস্যা হয়েছে।");
    });
}

// Firebase থেকে র‍্যাঙ্কিং লোড এবং প্রদর্শন করুন (প্রতি ব্যবহারকারীর সর্বোচ্চ স্কোর)
function displayRankings() {
    rankListElem.innerHTML = '<li>র‍্যাঙ্কিং লোড হচ্ছে...</li>';

    // Firebase-এর 'quizResults/QUIZ_ID' পাথে থেকে ডেটা লোড করুন
    database.ref('quizResults/' + QUIZ_ID).once('value', (snapshot) => {
        const userHighestScores = {}; // প্রতিটি ব্যবহারকারীর সর্বোচ্চ স্কোর সংরক্ষণের জন্য

        snapshot.forEach((childSnapshot) => {
            const data = childSnapshot.val();
            // Undefined বা invalid নাম এন্ট্রি বাদ দিন
            if (!data.name || typeof data.name !== 'string' || data.name.trim() === '') {
                // Optionally log to see bad data
                // console.warn("Invalid name found in Firebase data:", data);
                return; // Skip this entry
            }
            // Invalid স্কোর এন্ট্রি বাদ দিন
            const userScore = parseFloat(data.score);
            if (isNaN(userScore)) {
                // Optionally log to see bad data
                // console.warn("Invalid score found for user:", data.name, data.score);
                return; // Skip this entry
            }
            
            const userName = data.name;

            // যদি এই ব্যবহারকারী প্রথমবারের মতো আসে অথবা বর্তমান স্কোর পূর্ববর্তী সর্বোচ্চ স্কোরের চেয়ে বেশি হয়
            if (!userHighestScores[userName] || userScore > userHighestScores[userName].score) {
                userHighestScores[userName] = {
                    name: userName,
                    score: userScore
                };
            }
        });

        // userHighestScores অবজেক্ট থেকে অ্যারে তৈরি করুন
        const rankings = Object.values(userHighestScores);

        // স্কোর অনুযায়ী ডিসেন্ডিং অর্ডারে সর্ট করুন
        rankings.sort((a, b) => b.score - a.score);

        rankListElem.innerHTML = '';
        if (rankings.length === 0) {
            rankListElem.innerHTML = '<li>এখনো কোনো র‍্যাঙ্কিং নেই।</li>';
        } else {
            rankings.forEach((entry, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = `${index + 1}. ${entry.name} - স্কোর: ${entry.score.toFixed(2)}`;
                rankListElem.appendChild(listItem);
            });
        }
    })
    .catch((error) => {
        console.error("র‍্যাঙ্কিং লোড করতে সমস্যা হয়েছে:", error);
        rankListElem.innerHTML = '<li>র‍্যাঙ্কিং লোড করা যায়নি।</li>';
    });
} 
